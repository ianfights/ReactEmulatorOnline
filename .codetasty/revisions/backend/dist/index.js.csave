codetasty.revision.2.0
{"ts":1620737800,"restoring":false,"user_id":43024,"patch":[{"diffs":[[1,"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst WebSocket = __importStar(require(\"ws\"));\nconst fs = __importStar(require(\"fs\"));\nconst Gameboy = require('serverboy');\nlet port = 25565;\nconst server = new WebSocket.Server({ port: port });\nconsole.log(`Server started on ${port}`);\nserver.on('connection', socket => {\n    const gameboy = new Gameboy();\n    console.log(\"Started new gameboy process\");\n    var rom = fs.readFileSync('pc.gbc');\n    gameboy.loadRom(rom);\n    setInterval(() => {\n        let screen = gameboy.getScreen();\n        socket.send(screen.toString());\n        //console.log(\"Send screen\")\n        gameboy.doFrame();\n    }, 20);\n    socket.on('message', msg => {\n        if (msg.startsWith('K')) {\n            let key = msg.slice(1);\n            switch (key) {\n                case 'w':\n                    gameboy.pressKey('up');\n                    break;\n                case 's':\n                    gameboy.pressKey('down');\n                    break;\n                case 'a':\n                    gameboy.pressKey('left');\n                    break;\n                case 'd':\n                    gameboy.pressKey('right');\n                    break;\n                case 'z':\n                    gameboy.pressKey('b');\n                    break;\n                case 'x':\n                    gameboy.pressKey('a');\n                    break;\n                case \"Enter\":\n                    gameboy.pressKey('start');\n                    break;\n                case 'Shift':\n                    gameboy.pressKey('select');\n                    break;\n            }\n            //a \n        }\n    });\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":2523}],"length":2523}