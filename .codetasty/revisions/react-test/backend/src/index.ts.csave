codetasty.revision.2.0
{"ts":1620651436,"restoring":false,"user_id":43024,"patch":[{"diffs":[[1,"import * as WebSocket from 'ws';\r\nimport * as fs from 'fs';\r\nconst Gameboy = require('serverboy');\r\n\r\nconst server = new WebSocket.Server({ port: '300' });\r\n\r\nconsole.log(\"server started on 8080\")\r\n\r\n\r\n\r\nserver.on('connection', socket => {\r\n\r\n    const gameboy = new Gameboy();\r\n    console.log(\"Started new gameboy process\");\r\n    var rom = fs.readFileSync('./roms/pokeCrystal.gbc');\r\n    gameboy.loadRom(rom);\r\n\r\n    setInterval(() => {\r\n\r\n        let screen = gameboy.getScreen();\r\n        socket.send(screen.toString());\r\n        //console.log(\"Send screen\")\r\n        gameboy.doFrame();\r\n    }, 20);\r\n\r\n    socket.on('message', msg => {\r\n        if (msg.startsWith('K')) {\r\n            let key = msg.slice(1);\r\n\r\n            switch(key){\r\n                case 'w':\r\n                    gameboy.pressKey('up');\r\n                    break;\r\n                case 's':\r\n                    gameboy.pressKey('down');\r\n                    break;\r\n                case 'a': \r\n                    gameboy.pressKey('left');\r\n                    break;\r\n                case 'd':\r\n                    gameboy.pressKey('right');\r\n                    break;\r\n                case 'z':\r\n                    gameboy.pressKey('b');\r\n                    break;\r\n                case 'x':\r\n                    gameboy.pressKey('a');\r\n                    break;\r\n                case \"Enter\":\r\n                    gameboy.pressKey('start');\r\n                    break;\r\n                case 'Shift':\r\n                    gameboy.pressKey('select');\r\n                    break;\r\n            \r\n            }\r\n\r\n\r\n            //a \r\n        }\r\n    });\r\n\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":1640}],"length":1640}
{"ts":1620651918,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0,"\")\r\n\r\n\r\n"],[1,"let port = "],[0,"\r\nserver"]],"start1":194,"start2":194,"length1":16,"length2":27}],"length":1651}
{"ts":1620651921,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0," port = "],[1,"143"],[0,"\r\nserver"]],"start1":205,"start2":205,"length1":16,"length2":19}],"length":1654}
{"ts":1620651930,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0,"\r\n\r\n"],[-1,"let port = 143"],[0,"\r\nse"]],"start1":198,"start2":198,"length1":22,"length2":8}],"length":1640}
{"ts":1620651932,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0,"rverboy');\r\n"],[1,"let port = 143"],[0,"\r\nconst serv"]],"start1":88,"start2":88,"length1":24,"length2":38}],"length":1654}
{"ts":1620651935,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0,"rt: "],[-1,"'300'"],[1,"port"],[0," });"]],"start1":156,"start2":156,"length1":13,"length2":12}],"length":1653}
{"ts":1620651937,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0,"ole.log("],[-1,"\""],[1,"`"],[0,"server s"]],"start1":176,"start2":176,"length1":17,"length2":17}],"length":1653}
{"ts":1620651939,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0,"on 8080\""],[1,"`"],[0,")\r\n\r\n\r\n\r"]],"start1":200,"start2":200,"length1":16,"length2":17}],"length":1654}
{"ts":1620651940,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0," on 8080"],[-1,"\""],[0,"`)\r\n\r\n\r\n"]],"start1":199,"start2":199,"length1":17,"length2":16}],"length":1653}
{"ts":1620651945,"restoring":false,"user_id":43024,"patch":[{"diffs":[[0," on "],[-1,"8080"],[1,"${port}"],[0,"`)\r\n"]],"start1":199,"start2":199,"length1":12,"length2":15}],"length":1656}