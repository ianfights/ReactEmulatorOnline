codetasty.revision.2.0
{"ts":1620651528,"restoring":false,"user_id":43024,"patch":[{"diffs":[[1,"\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst WebSocket = __importStar(require(\"ws\"));\r\nconst fs = __importStar(require(\"fs\"));\r\nconst Gameboy = require('serverboy');\r\nconst server = new WebSocket.Server({ port: '300' });\r\nconsole.log(\"server started on 8080\");\r\nserver.on('connection', socket => {\r\n    const gameboy = new Gameboy();\r\n    console.log(\"Started new gameboy process\");\r\n    var rom = fs.readFileSync('./roms/pokeCrystal.gbc');\r\n    gameboy.loadRom(rom);\r\n    setInterval(() => {\r\n        let screen = gameboy.getScreen();\r\n        socket.send(screen.toString());\r\n        //console.log(\"Send screen\")\r\n        gameboy.doFrame();\r\n    }, 20);\r\n    socket.on('message', msg => {\r\n        if (msg.startsWith('K')) {\r\n            let key = msg.slice(1);\r\n            switch (key) {\r\n                case 'w':\r\n                    gameboy.pressKey('up');\r\n                    break;\r\n                case 's':\r\n                    gameboy.pressKey('down');\r\n                    break;\r\n                case 'a':\r\n                    gameboy.pressKey('left');\r\n                    break;\r\n                case 'd':\r\n                    gameboy.pressKey('right');\r\n                    break;\r\n                case 'z':\r\n                    gameboy.pressKey('b');\r\n                    break;\r\n                case 'x':\r\n                    gameboy.pressKey('a');\r\n                    break;\r\n                case \"Enter\":\r\n                    gameboy.pressKey('start');\r\n                    break;\r\n                case 'Shift':\r\n                    gameboy.pressKey('select');\r\n                    break;\r\n            }\r\n            //a \r\n        }\r\n    });\r\n});\r\n"]],"start1":0,"start2":0,"length1":0,"length2":2589}],"length":2589}